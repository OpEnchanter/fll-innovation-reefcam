<!DOCTYPE html>
<html>
    <head>
        <style>
            html {
                overflow: hidden;
            }

            body {
                width: 100%;
                height: 100vh;
                position: relative;
                margin: 0; /* Ensure no margin */
                background: linear-gradient(to bottom, rgb(0, 0, 25), rgb(0,0,75));
            }

            .video {
                width: 65%;
                height: 95%;
                background-color: black;
                border-radius: 10px;
                position: absolute;
                top: 2.5%; /* Center the video div vertically */
                left: 2.5%; /* Center the video div horizontally */
                overflow: hidden;
            }

            .sideBar { 
                width: 27%;
                height: 95%;
                background-color: black;
                border-radius: 10px;
                position: absolute;
                top: 2.5%; /* Center the video div vertically */
                left: 68.5%; /* Center the video div horizontally */
                overflow: hidden;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .capture {
                border-radius: 100%;
                width: 75px;
                aspect-ratio: 1/1;
                border-width: 10px;
                border-style: solid;
                background-color: rgba(175, 175, 175, 0.85);
                border-color: rgba(100, 100, 100, 0.85);
                transition-duration: 100ms;
                position: absolute;
                top: 85%;
                left: 50%;
                transform: translate(-50%, -50%); /* Center the button */
            }
            
            .capture:active {
                border-width: 0px;
            }

            .videoControl {
                border-radius: 100%;
                width: 45px;
                aspect-ratio: 1/1;
                border-width: 10px;
                border-style: solid;
                background-color: rgba(175, 175, 175, 0.85);
                border-color: rgba(100, 100, 100, 0.85);
                transition-duration: 100ms;
                position: absolute;
                top: 85%;
                left: 50%;
                transform: translate(-155%, -150%); /* Center the button */
            }

            .videoControl:active {
                border-width: 0px;
            }

            .rewind {
                border-radius: 100%;
                width: 45px;
                aspect-ratio: 1/1;
                border-width: 10px;
                border-style: solid;
                background-color: rgba(175, 175, 175, 0.85);
                border-color: rgba(100, 100, 100, 0.85);
                transition-duration: 100ms;
                position: absolute;
                top: 85%;
                left: 50%;
                transform: translate(-155%, 50%); /* Center the button */
            }

            .rewind:active {
                border-width: 0px;
            }

            .fastForward {
                border-radius: 100%;
                width: 45px;
                aspect-ratio: 1/1;
                border-width: 10px;
                border-style: solid;
                background-color: rgba(175, 175, 175, 0.85);
                border-color: rgba(100, 100, 100, 0.85);
                transition-duration: 100ms;
                position: absolute;
                top: 85%;
                left: 50%;
                transform: translate(-195%, -50%); /* Center the button */
            }

            .fastForward:active {
                border-width: 0px;
            }

            img {
                width: 25px;
                aspect-ratio: 1/1;
                position: absolute;
                transform: translate(-50%, -50%);
            }

            #pBar {
                height: 20px;
                width: 100%;
                background: rgb(0, 150, 0);
                position: absolute;
                top: 100%;
                transform: translateY(-10px);
                border-radius: 0px;
            }

            #capturedImage {
                width: 100%;
                height: 100%;
            }

            .capturedImageContainer {
                width: 75%;
                height: 150px;
                margin-top: 50px;
                background-color: gray;
                display: flex;
                align-items: center;
                justify-content: center;
                vertical-align: center;
                border-radius: 10px;
                overflow: hidden;
            }

            .noImage {
                transform: translate(25%, 25%);
            }

            button:hover {
                cursor: pointer;
            }

            .infoInput {
                margin-top: 15px;
                width: 75%;
                height: 150px;
                border-radius: 10px;
                font-family: sans-serif;
                background-color: rgb(75, 75, 75);
                color: white;
                border: none;
                resize: none;
            }

            .submitButton {
                width: 75%;
                height: 35px;
                background-color: rgb(0, 150, 0);
                color: black;
                border-radius: 10px;
                border: none;
                margin-top: 15px;
                font-size: 15px;
                transition-duration: 150ms;
            }

            .submitButton:hover {
                background-color: rgb(0, 100, 0);
            }

            .fishList {
                height: 75px;
                width: 75%;
                overflow-y: scroll;
                background-color: gray;
                font-family: sans-serif;
                margin-top: 15px;
                border-radius: 10px;
            }
        </style>
    </head>
    <body>
        <div class="video">
            <video id="videoElement" width="100%" height="100%" loop>
                <source src="" type="video/mp4" id="vid">
            </video>
            <button class="capture" onclick="captureImage()">
                <img src="../resources/icons/capture.png">
            </button>
        
            <button class="videoControl" onclick="changeVideoState()">
                <img style="width:15px;" src="../resources/icons/play.png" id="controlIco">
            </button>

            <button class="fastForward" onclick="rewind()">
                <img style="width:15px;" src="../resources/icons/rewind.png" id="rewindIco">
            </button>       
            

            <button class="rewind" onclick="fast_forward()">
                <img style="width:15px;" src="../resources/icons/fast_forward.png" id="fastForwardIco">
            </button>

            

            <div id="pBar"></div>
        </div>

        <div class="sideBar">
            <div class="capturedImageContainer">
                <canvas id="capturedImage" width="1920" height="1080"></canvas>
                <img src="../resources/icons/noimage.png" class="noImage" id="noImageIco">
            </div>

            <textarea class="infoInput" placeholder="Explain what you see..." wrap="hard"></textarea>

            <button class="submitButton" onclick="window.location.href = '/submit'">Submit</button>

            <div class="fishList">
                <ul>
                    
                </ul>
            </div>
        </div>

        <script>
            const url = new URL(window.location.href);
            const params = new URLSearchParams(url.search);

            const noImageIco = document.getElementById("noImageIco");
        
            var videoElement = document.getElementById("videoElement"); // Get the <video> element
            var sourceElement = document.getElementById("vid");
            sourceElement.src = "../resources/videos/" + params.get("video") + ".mp4";
            videoElement.load(); // Load the new source

            function captureImage () {
                const canvas = document.getElementById("capturedImage");
                const context = canvas.getContext('2d');

                context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

                
                noImageIco.style = "display: none;";
            }
        
            function changeVideoState() {
                if (videoElement.paused) {
                    videoElement.play(); // Correctly call play()
                    document.getElementById("controlIco").src = "../resources/icons/pause.png";
                } else {
                    videoElement.pause(); // Correctly call pause()
                    document.getElementById("controlIco").src = "../resources/icons/play.png";
                }
            }

            function updateProgressBar() {
                progress = videoElement.currentTime / videoElement.duration;

                var progressBar = document.getElementById("pBar");
                progressBar.style.width = `${progress*100}%`;
            }

            function rewind() {
                videoElement.currentTime -= 1;
            }

            function fast_forward() {
                videoElement.currentTime += 1;
            }

            setInterval(updateProgressBar, 0)
        </script>
    </body>
</html>
